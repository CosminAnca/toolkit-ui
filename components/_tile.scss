/* ==========================================================================
   COMPONENTS / TILE
   ========================================================================== */

// sky-toolkit-ui version
@import "../settings/version";

// Tile settings
$tile-padding: $global-spacing-unit-small !default;
$tile-border-width: 5px !default;
$tile-inner-border-colour: rgba(color(white), 0.3) !default;
$tile-outer-border-colour: rgba(color(white), 0.2) !default;
$tile-outer-border-width: $global-border-width !default;
$tile-animation-speed: $global-animation-speed;
$tile-animation-speed-slow: $global-animation-speed-slow;
$tile-shadow: $global-shadow !default;
$tile-arrow-size: 22px !default;
$tile-arrow-color: #e6e6ea;
$tile-shadow-color: rgba(160, 160, 160, 0.5);
$tile-gradient-default: "small";
$tile-gradient-default-hover: "large";

/**
 * Array of brands to generate specific themes for tile hover effects.
 * By default no themes are generated, to include themes overwrite the
 * `$included-tile-themes` array (see example)
 *
 * Example usage:
 * $included-tile-themes: "sky-1", "sky-arts", "sky-sports";
 *
 * Apply relevant class (ie `.c-tile--sky-1) to the `.c-tile` element or to a
 * parent element to apply to all nested tiles.
 *
 */

$included-tile-themes: "sky-1", "sky-account", "sky-atlantic", "sky-arts", "sky-box-sets", "sky-kids", "sky-living", "sky-movies", "sky-news", "sky-sports", "sky-store" !default;

/**
 * The base of the tile; provides the glass "border" and shadow.
 *
 * Also provides selected state, which gives a triangle arrowhead marker between
 * The tile and it's panel.
 *
 * 1. Forces tile markers to sit above corresponding panels
 */
.c-tile {
  position: relative;
  background-color: $tile-inner-border-colour;
  box-shadow: $tile-shadow;
  border: $tile-outer-border-width solid $tile-outer-border-colour;
  padding: $tile-border-width;
  margin-bottom: $global-spacing-unit;
  will-change: transform;
  z-index: 10; /* [1] */

  &.is-selected {
    /**
     * Arrow markers to signify panel relationship.
     *
     * 1. Positions the marker between tile and panel
     * 2. Need to take off an extra pixel here to allow for browser rendering/
     *    rounding quirks.
     * 3. Rotate 45deg to allow it to mask the panel gradient and look like a
     *    notch in the panel
     * 4. Gradients along the top and left to simulate shadow
     */
    &::before {
      display: block;
      content: "";
      position: absolute;  /* [1] */
      bottom: -$global-spacing-unit - ($tile-arrow-size/2) - 1px; /* [1, 2] */
      left: 50%;  /* [1] */
      width: $tile-arrow-size;
      height: $tile-arrow-size;
      margin-left: -$tile-arrow-size/2; /* [1] */
      -ms-transform: rotate(45deg);
      transform: rotate(45deg);
      background-color: $tile-arrow-color;
      background-image: linear-gradient(to bottom, $tile-shadow-color 0%, rgba(0, 0, 0, 0) 15px), linear-gradient(to right, $tile-shadow-color 0%, rgba(0, 0, 0, 0) 15px) /* [4] */
    }
  }

  &.c-tile--dark.is-selected::before {
    background-color: color(ui-dark);
    background-image: none;
  }
}

/**
 * The inner container of the tile provides the background gradient and extra
 * positioning for square tiles
 */
.c-tile__content {
  @include background-gradient($tile-gradient-default, "radial");

  .c-tile--square & {
    position: absolute;
    top: $tile-border-width;
    right: $tile-border-width;
    bottom: $tile-border-width;
    left: $tile-border-width;
    overflow: hidden; // Defensively clip overflowing text that can't be handled because of absolute positioning
  }

  /**
   * Set position to static below medium on collapsable tiles
   */
  .c-tile--collapsable & {
    @include mq($until: medium) {
      position: static;
    }
  }

  > :last-child {
    margin-bottom: 0;
  }

}

/**
 * The body/copy container for the tile; This should be applied to any content
 * which doesn't sit flush to the edge of the tile.
 */
.c-tile__body {
  padding: $tile-padding;

  > :last-child {
    margin-bottom: 0;
  }

}

/* Links
  =========================================== */

/**
 * Tiles can have links, just wrap the `.c-tile__content` with a `a.c-tile__link`
 * node.
 */
.c-tile__link {
  display: block;
  color: inherit;
  transition: color $tile-animation-speed ease;

  &,
  &:hover,
  &:focus {
    text-decoration: none;
  }
}

/* Media
  =========================================== */

/**
 * Container for tile media which takes the top 55% of the tile when used.
 * This usually (but not always) contains a .c-tile-poster.
 *
 * Media and caption pairs should only be used in conjunction with the
 * `c-tile--square` modifier
 */
.c-tile__media {
  overflow: none;
  display: block;
  height: 55%;

  /**
   * Hide media below medium on collapsable tiles
   */
  .c-tile--collapsable & {
    @include mq($until: medium) {
      display: none;
    }
  }
}

/**
 * A poster is a full bleed image which scales when the lniked tile is hovered.
 */
.c-tile__poster {
  transition: transform $tile-animation-speed-slow ease;
  will-change: transform;

  .c-tile__link:hover & {
    -ms-transform: scale(1.05, 1.05);
    transform: scale(1.05, 1.05);
  }
}

/**
 * Captions are needed for media tiles; they add a new background gradient and
 * take up the lower 50% of the tile.
 */
.c-tile__caption {
  @include background-gradient($tile-gradient-default);
  position: relative;
  height: 45%;

  /**
   * Sets height to auto below medium on collapsable tiles
   */
  .c-tile--collapsable & {
    @include mq($until: medium) {
      height: auto;
    }
  }

  .c-tile__link:focus &,
  .c-tile__link:hover & {
    text-decoration: underline;
  }

  // Pseudo element used for hover state background
  &::before {
    @include background-gradient($tile-gradient-default-hover);
    will-change: transform;

    content: "";
    opacity: 0;
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    transition: opacity $tile-animation-speed ease;

    .c-tile__link:focus &,
    .c-tile__link:hover & {
      opacity: 1;
    }
  }

}

/* Titles
  =========================================== */

/**
 * Large scalable title for large tiles (typically those used in >=50% widths)
 *
 * Normal heading classes e.g. `c-heading-alpha` are more useful in flexible
 * tiles, but square tiles need more specific and scalable headings in order to
 * prevent overflow â€“ hence the explicit font-size and line-height values rather
 * than the `@font-size mixin`.
 */
.c-tile__title {
  position: relative;
  font-size: $text-delta;
  line-height: 1.3;

  @include mq($from: medium) {
    font-size: 3.4vw;
  }

  @include mq($from: large) {
    font-size: $text-gamma;
  }
}

/**
 * Smaller static titles for smaller tiles (usually 33% widths)
 */
.c-tile__small-title {
  position: relative;
  font-size: $text-delta;
  line-height: 1.3;

  @include mq($from: medium) {
    font-size: $text-body;
  }
}

/* Square modifier
  =========================================== */

/**
 * Forces the tile to keep a square ratio
 */
.c-tile--square {
  height: 0;
  padding-top: 100%;

  /**
   * Collapses square ratio at medium and sets to auto height
   */
  &.c-tile--collapsable {
    @include mq($until: medium) {
      height: auto;
      padding-top: 0;
    }
  }
}

/* Tile shine
  =========================================== */

/**
 * Tile shine to be applied to a .c-shine component to give the correct positioning
 * when used on a Tile.
 */
.c-tile__shine {
  position: absolute;
  right: 0;
  left: 0;
  z-index: 1;
}

.c-tile__shine--top {
  top: -($global-spacing-unit-small + $tile-border-width);
}

.c-tile__shine--bottom {
  bottom: -($global-spacing-unit-small + $tile-border-width);
}

/* Tile themes
  =========================================== */

@if $included-tile-themes {
  @each $brand in $included-tile-themes {
    // For each brand generate a tile theme class i.e. .t-tile-sky-1
    .c-tile--#{$brand} {

      .c-tile__link:focus,
      .c-tile__link:hover {
        color: color(white);
      }

      // Set up style overides
      .c-tile__caption::before {
        @include background-gradient($brand);
      }
    }
  }
}
